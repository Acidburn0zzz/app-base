#!/bin/sh

if [ "$1" == "install_event" ]; then
    logger -p local6.notice -t clearsync "base - performing post-install cleanup"

    # TODO: see how this behaves.  It should only be done
    # on virtual machines (use virt-what tool)
    sed -i -e 's/ rhgb/ video=vesafb vga=0x314 rhgb/' /boot/grub/grub.conf

    # TODO: anaconda should really use "Linux" instead of ClearOS xyz
    # It's referring to the kernel, not the OS
    sed -i -e 's/ClearOS Community/Linux/' /boot/grub/grub.conf
    sed -i -e 's/ClearOS Professional/Linux/' /boot/grub/grub.conf
elif [ "$1" == "webconfig_change_event" ]; then
    logger -p local6.notice -t clearsync "base - running webconfig restart request"

    while [ -n "`/sbin/pidof -x wc-yum`" ]; do
        logger -p local6.notice -t clearsync 'base - waiting to restart webconfig'
        sleep 3
    done

    logger -p local6.notice -t clearsync 'base - restarting webconfig'
    /sbin/service webconfig condrestart
fi
